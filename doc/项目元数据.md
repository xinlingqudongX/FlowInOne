## 项目元数据说明

### 项目介绍

FlowInOne是一个基于NestJS的现代化后端应用框架，旨在提供高性能、可扩展的API服务。项目集成了最新的技术栈，包括TypeScript、Fastify/Express、TypeORM、SQLite等，为开发者提供完整的开发体验。

### 项目结构
后端项目结构
```
src/
├── project/               # 项目管理模块
│  └── entities/         # 项目相关实体
│       ├── project.entity.ts      # 项目实体
│      └── project-asset.entity.ts # 项目资产实体
├── workflow-graph/        #工作流图模块
│  └── entities/         #工作流图相关实体
│       └── workflow-graph.entity.ts #工作流图实体
├── task-node/             # 任务节点模块
│   └── entities/         # 任务节点相关实体
│       ├── task-node.entity.ts    # 任务节点实体
│       └── task-output.entity.ts   # 任务产出实体
├── entities/              #基础数据库实体
│  └── user.entity.ts
├── services/              # 业务服务
│   └── user.service.ts
├── adapter-factory.ts     # HTTP适配器工厂
├── app.controller.spec.ts # 控制器测试文件
├── app.controller.ts      # 主控制器
├── app.module.ts          #根模块
├── app.service.ts         # 主服务
├── mikro-orm.config.ts    # MikroORM配置
├── mikro-orm.module.ts    # MikroORM模块
└── main.ts               # 应用入口文件

doc/
├── 项目元数据.md          # 项目文档
└── 项目结构.md            # 详细项目结构文档

schema/                    # 数据库模式定义
test/                     #测试文件
```

### 项目目标

- 提供高性能的API服务
- 支持多种HTTP引擎（Express/Fastify）
- 集成现代化的API文档生成
- 使用TypeORM进行数据库操作
- 提供完整的TypeScript类型支持
- 提供页面用于配置项目，然后进入项目中默认有一个根节点

### 项目技术

- 开发语言：TypeScript
- 后端框架：Nest.js
- 后端框架适配器：Fastify
- 数据库框架：MikroORM
- 数据库：SQLite
- 数据验证依赖：zod
- API文档生成依赖：scalar，引用：[NestJS-scalar](https://scalar.com/products/api-references/integrations/nestjs)


#### 使用说明

- 启动应用后访问 http://localhost:3000/api-reference 查看API文档
- 文档会自动从NestJS路由和装饰器生成
- 支持交互式API测试功能

#### Fastify适配器配置

Fastify作为默认HTTP引擎，请执行以下命令安装依赖：

```bash
pnpm install @nestjs/platform-fastify fastify
```

Fastify适配器已在src/main.ts中配置：

```typescript
import { FastifyAdapter } from '@nestjs/platform-fastify';

async function bootstrap() {
  const app = await NestFactory.create(AppModule, new FastifyAdapter());
  // ... 其他配置
  await app.listen(process.env.PORT ?? 3000, '0.0.0.0');
}
```

启动应用：

```bash
# 开发模式
pnpm run start:dev

# Fastify开发模式
pnpm run start:fastify:dev

# 生产模式
pnpm run start:prod

# Fastify生产模式
pnpm run start:fastify
```

Fastify通常比Express提供更好的性能。

#### 开发工具和命令

项目提供了丰富的开发工具和命令：

```bash
# 代码格式化
pnpm run format

# 代码检查
pnpm run lint

# 类型检查
pnpm run type-check

# 运行测试
pnpm test

# 监听模式运行测试
pnpm run test:watch

# 生成测试覆盖率报告
pnpm run test:cov

# 调试模式运行测试
pnpm run test:debug

# 运行端到端测试
pnpm run test:e2e
```

#### 项目配置

- **TypeScript配置**: `tsconfig.json` 和 `tsconfig.build.json`
- **ESLint配置**: 集成在项目中，提供代码质量保证
- **Prettier配置**: `.prettierrc` 文件定义代码格式化规则
- **测试配置**: Jest配置在 `jest` 部分和 `test/jest-e2e.json`
- **数据库配置**: TypeORM配置，使用SQLite作为默认数据库
- **数据验证**: 使用zod进行数据验证

#### 数据验证示例

使用zod进行数据验证：

```typescript
import { z } from 'zod';

const userSchema = z.object({
  username: z.string().min(3).max(50),
  email: z.string().email(),
  isActive: z.boolean().optional().default(true)
});

// 验证数据
const result = userSchema.safeParse(userData);
if (!result.success) {
  // 处理验证错误
  console.error(result.error);
}
```

#### 数据库配置（可选）

项目支持使用MikroORM作为ORM框架，SQLite作为数据库。详细配置指南请参见：[数据库配置示例.md](./数据库配置示例.md)

主要配置包括：

- **数据库类型**: sqlite
- **数据库文件**: database.sqlite
- **实体目录**: src/entities/*.entity.ts
- **调试模式**: 开启（开发环境）

如需启用数据库功能，请参考以下步骤：

1. 在app.module.ts中导入MikroOrmModule
2. 配置数据库连接选项
3. 安装依赖：`pnpm install @mikro-orm/core @mikro-orm/nestjs @mikro-orm/sqlite sqlite3`

示例配置：

```typescript
import { MikroOrmModule as MikroOrmNestModule } from '@mikro-orm/nestjs';
import config from './mikro-orm.config';

@Module({
  imports: [
    MikroOrmNestModule.forRoot(config),
  ],
  // ... 其他配置
})
export class AppModule {}
```

## 文档

- [详细项目文档](./项目元数据.md) -包含完整的技术说明和配置指南
- [项目结构详细说明](./项目结构说明.md) - 包含各模块详细功能说明
- [数据库配置示例](./数据库配置示例.md) - 如需启用数据库功能，请参考此指南